# 골프 통계 서비스 개발 준비사항 체크리스트

## 📋 프로젝트 개요
- **서비스 유형**: 유저 통계 앱 서비스
- **데이터 소스**: 골프 시뮬레이터 (개발 중)
- **게임 모드**: 로컬 플레이 (LOCAL) 우선
- **데이터 상태**: 샘플 데이터 필요

---

## ✅ 1. 프로젝트 구조 준비

### 1.1 Flutter 앱 프로젝트
- [ ] Flutter 프로젝트 초기화
- [ ] 프로젝트 구조 설계 (models, services, screens, widgets)
- [ ] 의존성 패키지 설정 (pubspec.yaml)
  - [ ] HTTP 클라이언트 (dio)
  - [ ] 상태 관리 (riverpod 또는 provider)
  - [ ] JSON 직렬화 (json_annotation, freezed)
  - [ ] 로컬 저장소 (shared_preferences 또는 hive)

### 1.2 백엔드 API 서버
- [ ] 백엔드 프레임워크 선택 및 초기화
  - 옵션: Node.js/Express, Python/FastAPI, Go/Gin 등
- [ ] 프로젝트 구조 설정
  - [ ] API 라우터
  - [ ] 데이터 모델
  - [ ] 서비스 레이어 (Stack, Create, Serve)
  - [ ] 데이터베이스 연결

### 1.3 데이터베이스
- [ ] 데이터베이스 선택 및 설정
  - 권장: PostgreSQL (복잡한 통계 쿼리)
- [ ] 데이터베이스 연결 설정
- [ ] 마이그레이션 도구 설정

---

## ✅ 2. 데이터베이스 스키마 설계

### 2.1 핵심 테이블
- [ ] `rounds` 테이블 (2.1 라운드 데이터)
  - [ ] game_session_id, game_mode, game_rule 필드
  - [ ] user_id, round_id, total_score 등 필수 필드
  - [ ] 인덱스 설정 (game_session_id, user_id)

- [ ] `holes` 테이블 (2.2 홀 데이터)
  - [ ] hole_score_id (PK, Unique)
  - [ ] round_id (FK)
  - [ ] hole_id (마스터 ID)
  - [ ] hole_number, strokes, putts 등

- [ ] `shots` 테이블 (2.3 샷 데이터)
  - [ ] shot_id (PK)
  - [ ] hole_score_id (FK) - **중요: hole_id가 아님**
  - [ ] user_id, shot_number, club_type (Nullable)
  - [ ] shot_type, lie, putt_length 등

- [ ] `shot_sensors` 테이블 (2.4 센서 데이터)
  - [ ] shot_id (FK)
  - [ ] BALL SPEED, LAUNCH ANG., SPIN RATE 등 8개 필드
  - [ ] ATTACK ANG., CLUB PATH 등 7개 클럽 필드

- [ ] `turn_events` 테이블 (2.5 턴 이벤트)
  - [ ] turn_event_id (PK)
  - [ ] game_session_id (FK)
  - [ ] event_type, event_at 등

### 2.2 통계 테이블
- [ ] `user_statistics` 테이블 (3.1 유저 누적 통계)
  - [ ] user_id (PK)
  - [ ] total_rounds, average_score, best_score
  - [ ] fairway_accuracy, gir_percentage
  - [ ] average_putts_per_round 등

### 2.3 마스터 데이터 테이블
- [ ] `golf_courses` 테이블 (CC 데이터)
  - [ ] cc_id (PK)
  - [ ] course_id
  - [ ] 골프장 정보 (이름, 위치 등)

- [ ] `holes_master` 테이블 (홀 마스터)
  - [ ] hole_id (PK)
  - [ ] cc_id, course_id
  - [ ] hole_number, par, distance

- [ ] `code_masters` 테이블 (4. 코드 마스터)
  - [ ] code_type (game_mode, game_rule, club_type 등)
  - [ ] code_value
  - [ ] code_label (한글명)

---

## ✅ 3. CC 데이터 (골프장 마스터) 준비

### 3.1 데이터 확인
- [x] examples 폴더에 Excel 파일 존재 확인
  - test_golf_data.xlsx
  - test_golf_data_111.xlsx
  - test_golf_data_v2_20251027.xlsx

### 3.2 데이터 파싱 및 마이그레이션
- [ ] Excel 파일 구조 분석
- [ ] CC 데이터 파싱 스크립트 작성
- [ ] 데이터베이스 마이그레이션 스크립트 작성
- [ ] 골프장 마스터 데이터 삽입
- [ ] 홀 마스터 데이터 삽입

---

## ✅ 4. 샘플 데이터 생성

### 4.1 로컬 플레이 모드 샘플 데이터
- [ ] 샘플 데이터 생성 스크립트 작성
- [ ] 로컬 플레이 시나리오 설계
  - [ ] 2~6명 유저
  - [ ] game_session_id 공유
  - [ ] 18홀 라운드 데이터

### 4.2 샘플 데이터 구조
- [ ] Round 데이터 (2.1)
  - [ ] game_mode: 'LOCAL'
  - [ ] game_rule: 'RULE_STROKE' 또는 'RULE_SCRAMBLE'
  - [ ] game_session_id: 동일 세션 ID
  - [ ] 여러 user_id의 round_id 생성

- [ ] Hole 데이터 (2.2)
  - [ ] 18홀 × 유저 수만큼 hole_score_id 생성
  - [ ] hole_id는 마스터 데이터 참조

- [ ] Shot 데이터 (2.3)
  - [ ] 각 홀당 3~7샷 정도
  - [ ] hole_score_id 연결
  - [ ] club_type, shot_type, lie 등

- [ ] 센서 데이터 (2.4)
  - [ ] 각 shot_id에 센서 데이터 연결

### 4.3 샘플 데이터 검증
- [ ] 데이터 무결성 검증
- [ ] FK 관계 검증
- [ ] 통계 계산 가능 여부 확인

---

## ✅ 5. API 엔드포인트 설계

### 5.1 데이터 수집 (Stack) API
- [ ] `POST /api/rounds` - 라운드 종료 시 데이터 수집
  - [ ] Round, Hole, Shot, Sensor, Event 데이터 일괄 수신
  - [ ] 데이터 검증 로직
  - [ ] 트랜잭션 처리

### 5.2 데이터 가공 (Create) API
- [ ] 통계 계산 배치 작업
  - [ ] 라운드 저장 시 유저 통계 업데이트
  - [ ] 랭킹 계산 (game_session_id 기반)

### 5.3 데이터 제공 (Serve) API
- [ ] `GET /api/users/:userId/statistics` - 유저 누적 통계
- [ ] `GET /api/users/:userId/rounds` - 라운드 목록
- [ ] `GET /api/rounds/:roundId` - 라운드 상세
- [ ] `GET /api/sessions/:sessionId` - 게임 세션 정보
- [ ] `GET /api/code-masters` - 코드 마스터 조회

---

## ✅ 6. 코드 마스터 데이터 준비

### 6.1 코드 마스터 정의 (4장 참조)
- [ ] Game Mode: SINGLE, LOCAL, MULTIPLAY, TOURNEY
- [ ] Game Rule: RULE_STROKE, RULE_FOURBALL, RULE_FOURSOME, RULE_SCRAMBLE
- [ ] Tee Box: TB_BLACK, TB_BLUE, TB_WHITE, TB_RED, TB_GOLD
- [ ] Club Type: CLUB_D, CLUB_W3, CLUB_I3~I9, CLUB_PW, CLUB_P 등
- [ ] Shot Type: SHOT_T, SHOT_A, SHOT_C, SHOT_B, SHOT_P
- [ ] Lie: LIE_TEE, LIE_FAIR, LIE_ROUGH, LIE_BUNK, LIE_GREEN 등
- [ ] Penalty: PEN_OB, PEN_WATER, PEN_UNPLAY
- [ ] Event Type: EVT_TURN_SKIP, EVT_TURN_PASS

### 6.2 코드 마스터 데이터 삽입
- [ ] 데이터베이스에 코드 마스터 데이터 삽입
  - [x] `code_master_data.json` 파일 생성 (한글 메뉴명 정의)
  - [ ] JSON 데이터를 `code_masters` 테이블에 적재하는 스크립트 작성
- [ ] API로 코드 마스터 조회 가능하도록 설정

---

## ✅ 7. 비즈니스 로직 준비

### 7.1 통계 계산 정책
- [ ] RULE_STROKE/FOURBALL만 개인 통계에 포함
- [ ] RULE_FOURSOME/SCRAMBLE 샷은 통계 제외
- [ ] 샷 데이터는 user_id 기준 집계

### 7.2 랭킹 계산 로직
- [ ] game_session_id 기반 랭킹
- [ ] TOURNEY 모드: is_ranking_eligible 필터링
- [ ] 팀전: 팀 스코어 기준 랭킹

### 7.3 팀전 데이터 처리
- [ ] RULE_FOURSOME/SCRAMBLE: 팀원 1명에만 Hole/Shot 저장
- [ ] 나머지 팀원: Round 데이터만 (total_score, rank 복제)

---

## ✅ 8. 개발 환경 설정

### 8.1 개발 도구
- [ ] Git 저장소 초기화
- [ ] .gitignore 설정
- [ ] 환경 변수 설정 (.env)
  - [ ] 데이터베이스 연결 정보
  - [ ] API 키 (필요시)

### 8.2 문서화
- [ ] API 문서 작성 (Swagger/OpenAPI)
- [ ] 데이터베이스 ERD 작성
- [ ] 개발 가이드 작성

---

## ✅ 9. 테스트 준비

### 9.1 테스트 데이터
- [ ] 샘플 데이터로 통계 계산 검증
- [ ] 다양한 게임 모드 시나리오 테스트

### 9.2 테스트 환경
- [ ] 단위 테스트 설정
- [ ] 통합 테스트 설정
- [ ] API 테스트 도구 설정 (Postman 등)

---

## 📝 다음 단계

준비사항 체크 완료 후:
1. Flutter 프로젝트 초기화
2. 백엔드 프로젝트 초기화
3. 데이터베이스 스키마 생성
4. CC 데이터 마이그레이션
5. 샘플 데이터 생성 스크립트 작성

