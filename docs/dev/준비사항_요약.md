# 골프 통계 서비스 개발 준비사항 요약

## 📌 현재 상황

### ✅ 확인된 사항
1. **프로젝트 타입**: Flutter 앱 서비스 (유저 통계)
2. **데이터 소스**: 골프 시뮬레이터 (개발 중)
3. **게임 모드**: 로컬 플레이 (LOCAL) 우선
4. **CC 데이터**: examples 폴더에 Excel 파일 존재
   - test_golf_data.xlsx
   - test_golf_data_111.xlsx
   - test_golf_data_v2_20251027.xlsx

### ⚠️ 필요한 작업
1. **프로젝트 초기화**: Flutter 프로젝트 생성
2. **백엔드 설정**: API 서버 구조 설계
3. **데이터베이스 설계**: 스키마 생성
4. **CC 데이터 파싱**: Excel → DB 마이그레이션
5. **샘플 데이터 생성**: 로컬 플레이 모드 테스트 데이터

---

## 🎯 우선순위별 준비 작업

### Phase 1: 프로젝트 초기화 (필수)

#### 1.1 Flutter 앱 프로젝트
```bash
# Flutter 프로젝트 생성
flutter create golf_stats_app
cd golf_stats_app
```

**필요한 패키지 (pubspec.yaml)**
- `dio`: HTTP 클라이언트
- `riverpod` 또는 `provider`: 상태 관리
- `freezed` + `json_annotation`: 모델 클래스
- `shared_preferences`: 로컬 저장소

#### 1.2 백엔드 프로젝트 선택
**옵션 A: Node.js/Express**
```bash
mkdir backend
cd backend
npm init -y
npm install express pg sequelize
```

**옵션 B: Python/FastAPI**
```bash
mkdir backend
cd backend
pip install fastapi uvicorn sqlalchemy psycopg2-binary pandas openpyxl
```

**옵션 C: Go/Gin**
```bash
mkdir backend
cd backend
go mod init golf-stats-backend
go get github.com/gin-gonic/gin
go get gorm.io/gorm
go get gorm.io/driver/postgres
```

#### 1.3 데이터베이스 설정
- **PostgreSQL** 설치 및 데이터베이스 생성
- 연결 정보 환경 변수 설정 (.env)

---

### Phase 2: 데이터베이스 스키마 설계 (필수)

#### 2.1 핵심 테이블 구조

**rounds 테이블**
- PK: round_id
- game_session_id (Nullable, 인덱스)
- game_mode, game_rule
- user_id (인덱스)
- total_score, total_par
- rank, is_ranking_eligible
- 기타 통계 필드

**holes 테이블**
- PK: hole_score_id (Unique)
- FK: round_id
- hole_id (마스터 ID)
- hole_number, strokes, putts
- fairway_hit, green_in_regulation

**shots 테이블**
- PK: shot_id
- FK: hole_score_id (⚠️ hole_id가 아님!)
- user_id, shot_number
- club_type (Nullable)
- shot_type, lie
- putt_length, putt_made
- TOTAL, CARRY, FROM PIN 등

**shot_sensors 테이블**
- FK: shot_id
- BALL SPEED, LAUNCH ANG., SPIN RATE 등 8개
- ATTACK ANG., CLUB PATH 등 7개

**user_statistics 테이블**
- PK: user_id
- total_rounds, average_score
- fairway_accuracy, gir_percentage
- average_putts_per_round 등

**마스터 데이터 테이블**
- golf_courses (cc_id, course_id)
- holes_master (hole_id, cc_id, par, distance)
- code_masters (코드 타입별)

---

### Phase 3: CC 데이터 마이그레이션 (필수)

#### 3.1 Excel 파일 구조 분석
- examples 폴더의 Excel 파일 구조 확인
- 골프장 정보, 홀 정보 추출

#### 3.2 파싱 스크립트 작성
```python
# parse_cc_data.py 예시
import pandas as pd
from sqlalchemy import create_engine

# Excel 읽기
df = pd.read_excel('examples/test_golf_data.xlsx')

# DB 연결
engine = create_engine('postgresql://...')

# 데이터 삽입
df.to_sql('golf_courses', engine, if_exists='append')
```

#### 3.3 마이그레이션 실행
- 골프장 마스터 데이터 삽입
- 홀 마스터 데이터 삽입
- 코드 마스터 데이터 삽입

---

### Phase 4: 샘플 데이터 생성 (필수)

#### 4.1 로컬 플레이 시나리오
- **게임 모드**: LOCAL
- **게임 룰**: RULE_STROKE (개인전)
- **참가자**: 2~6명
- **game_session_id**: 동일 세션 ID 공유

#### 4.2 샘플 데이터 구조
```
게임 세션: SESSION_LOCAL_001
├── 유저 A (round_id: 1001)
│   ├── Hole 1 (hole_score_id: 10001)
│   │   ├── Shot 1 (shot_id: 100001)
│   │   ├── Shot 2 (shot_id: 100002)
│   │   └── ...
│   └── Hole 2~18...
├── 유저 B (round_id: 1002)
│   └── ...
└── 유저 C (round_id: 1003)
    └── ...
```

#### 4.3 샘플 데이터 생성 스크립트
- 랜덤 또는 고정된 스코어 생성
- 센서 데이터 시뮬레이션
- 통계 계산 가능한 데이터 생성

---

## 🔧 기술 스택 제안

### 프론트엔드 (Flutter)
- **상태 관리**: Riverpod (권장) 또는 Provider
- **HTTP**: Dio
- **로컬 DB**: Hive 또는 SQLite (선택)
- **UI**: Material Design 3

### 백엔드
- **프레임워크**: FastAPI (Python) 또는 Express (Node.js)
- **데이터베이스**: PostgreSQL
- **ORM**: SQLAlchemy (Python) 또는 Sequelize (Node.js)
- **캐싱**: Redis (선택)

### 개발 도구
- **API 문서**: Swagger/OpenAPI
- **테스트**: Postman, pytest/jest
- **버전 관리**: Git

---

## 📋 체크리스트

### 즉시 시작 가능한 작업
- [ ] Flutter 프로젝트 초기화
- [ ] 백엔드 프로젝트 초기화
- [ ] PostgreSQL 데이터베이스 생성
- [ ] Excel 파일 구조 분석
- [ ] 데이터베이스 스키마 설계 문서 작성

### 다음 단계 작업
- [ ] 데이터베이스 마이그레이션 스크립트 작성
- [ ] CC 데이터 파싱 및 삽입
- [ ] 코드 마스터 데이터 준비
- [ ] 샘플 데이터 생성 스크립트 작성
- [ ] API 엔드포인트 설계

### 개발 시작 전 필수
- [ ] 데이터베이스 스키마 생성 완료
- [ ] CC 데이터 마이그레이션 완료
- [ ] 샘플 데이터 생성 완료
- [ ] API 기본 구조 설정 완료

---

## 🚀 다음 액션 아이템

1. **Excel 파일 구조 확인**
   - `prepare_project.py` 실행하여 Excel 파일 분석
   - CC 데이터 구조 파악

2. **프로젝트 초기화 결정**
   - Flutter 프로젝트 생성
   - 백엔드 프레임워크 선택 (Python/FastAPI 권장)

3. **데이터베이스 스키마 작성**
   - SQL 스크립트 또는 ORM 모델 작성
   - 마이그레이션 파일 생성

4. **CC 데이터 파싱 스크립트 작성**
   - Excel → CSV 또는 직접 DB 삽입

5. **샘플 데이터 생성 스크립트 작성**
   - 로컬 플레이 모드 데이터 생성
   - 통계 계산 가능한 데이터 생성

---

## 📝 참고사항

### 중요 설계 포인트
1. **hole_id vs hole_score_id**: 샷 데이터는 반드시 hole_score_id에 연결
2. **club_type**: NULL 허용으로 설계 (R&D 완료 전 대비)
3. **통계 계산**: RULE_STROKE/FOURBALL만 개인 통계에 포함
4. **로컬 플레이**: game_session_id로 그룹핑, rank는 세션 내에서 계산

### 데이터 흐름
```
시뮬레이터 → API (POST /api/rounds) → DB 저장 → 통계 계산 (비동기) → API (GET /api/users/:id/statistics)
```

---

## ❓ 확인 필요 사항

1. **백엔드 프레임워크 선호도**: Python/FastAPI, Node.js/Express, Go/Gin 중 선택
2. **데이터베이스**: PostgreSQL 사용 가능 여부
3. **Excel 파일 구조**: examples 폴더의 Excel 파일 구조 확인 필요
4. **샘플 데이터 규모**: 몇 개의 라운드 데이터가 필요한지

